import{jsx as _jsx,jsxs as _jsxs}from"react/jsx-runtime";import{Children,isValidElement,useEffect,useRef,useState}from"react";import{Description}from"./Description";import{Title}from"./Title";import{cn}from"../../helpers/cn";import{Action}from"./Action";import{useClick,useDismiss,useRole,useInteractions,useFloating,autoUpdate,offset,flip,shift,useHover,useTransitionStyles,FloatingArrow,arrow,autoPlacement,hide}from"@floating-ui/react";import{Container}from"./Container";import{XCircle}from"phosphor-react";import{PopoverContext}from"./PopoverContext";import{useTheme}from"../../Keep/ThemeContext";const PopoverComponent=({children:e,className:o,trigger:t="click",position:i="bottom-start",showDismissIcon:r=!0,showArrow:s=!0,icon:n,...l})=>{const[a,c]=useState(!1),[p,m]=useState(!0);var f=useRef(null),d=useTheme().theme.popover["root"],{refs:i,floatingStyles:u,context:h}=useFloating({open:a,onOpenChange:c,middleware:[offset(10),flip(),shift(),arrow({element:f}),autoPlacement({crossAxis:!0,alignment:"start",allowedPlacements:["top","right","bottom","left"]}),hide({strategy:"escaped"})],whileElementsMounted:autoUpdate,placement:i}),C=useHover(h,{enabled:"hover"===t}),t=useClick(h,{enabled:"click"===t}),v=useDismiss(h),x=useRole(h),g=useTransitionStyles(h,{duration:300})["styles"],{getReferenceProps:t,getFloatingProps:v}=useInteractions([t,v,x,C]),x=Children.toArray(e).filter(e=>isValidElement(e)&&e.type===Action);const P=Children.toArray(e).some(e=>isValidElement(e)&&e.type===Title);C=Children.toArray(e).filter(e=>isValidElement(e)&&e.type!==Action);return useEffect(()=>{P?m(!0):m(!1)},[P]),_jsxs(PopoverContext.Provider,{value:{isTitleExist:p},children:[_jsx("div",{className:"inline-block",ref:i.setReference,...t(),onClick:()=>c(!a),children:x}),a&&_jsxs("div",{...l,ref:i.setFloating,style:{...u,...g},...v(),className:cn(o,d.base),children:[s&&_jsx(FloatingArrow,{ref:f,context:h,fill:"#FFFFFF"}),r&&_jsx("button",{onClick:()=>c(!1),className:d.icon,children:void 0!==n?n:_jsx(XCircle,{size:24,color:"#5E718D",weight:"light"})}),_jsx("div",{children:C})]})]})},Popover=(Title.displayName="Popover.Title",Description.displayName="Popover.Description",Action.displayName="Popover.Body",Container.displayName="Popover.Container",Object.assign(PopoverComponent,{Title:Title,Description:Description,Action:Action,Container:Container}));export{PopoverComponent,Popover};